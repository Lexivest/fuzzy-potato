<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Kadazon – Authentication</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{
      font-family:system-ui,-apple-system,sans-serif;
      display:flex;align-items:center;justify-content:center;
      height:100vh;margin:0;background:#f7f7f7
    }
    .card{
      max-width:380px;width:92%;padding:2rem;border-radius:12px;background:#fff;
      text-align:center;box-shadow:0 2px 8px #0002
    }
    h2{margin:.2rem 0 .6rem;font-weight:600}
    p{line-height:1.5;margin:.4rem 0}
  </style>
</head>
<body>
  <div class="card" id="card">
    <h2>Processing…</h2>
    <p>Please wait a moment.</p>
  </div>

<script>
(() => {
  const card = document.getElementById('card');
  const query = new URLSearchParams(location.search.slice(1));

  /* 1. Supabase appended an error (expired / already‑used link) */
  if (query.has('error')) {
    card.innerHTML =
      '<h2>Link invalid or expired</h2>' +
      '<p>' + (query.get('error_description')
        || 'Please request a new email from the Kadazon app.') + '</p>';
    return;
  }

  /* 2. Supabase appended a success code */
  if (query.has('code')) {
    const flow = query.get('type');  // signup | recovery | magiclink
    const msg  = flow === 'recovery'
      ? 'Password reset successful!'
      : 'Email verified!';

    card.innerHTML =
      '<h2>' + msg + '</h2>' +
      '<p>You may now return to the Kadazon app and log in.</p>';
    return;
  }

  /* 3. Fallback – no code, no error */
  card.innerHTML =
    '<h2>Something went wrong</h2>' +
    '<p>No authentication information found in this link.</p>' +
    '<p>Please request a fresh email from the Kadazon app.</p>';
})();
</script>
</body>
</html>
